## 如何保证数据库与缓存双写一致性



## 场景

读取缓存步骤一般没有什么问题，但是一旦涉及到数据更新：数据库和缓存更新，就容易出现**缓存(Redis)和数据库（MySQL）间的数据一致性问题**。





1.如果先修改数据库，在删除缓存前，写库的线程宕机了，没有删除掉缓存，会出现数据不一致情况。





2.如果删除了缓存Redis，还没有来得及写库MySQL，另一个线程就来读取，发现缓存为空，则去数据库中读取数据写入缓存，此时缓存中为脏数据。





## Cache Aside Pattern



读的时候，先读缓存，缓存没有的话，就读数据库，然后取出数据后放入缓存，同时返回响应。

更新的时候，**先删除缓存，然后更新数据库**。





### 为什么是删除缓存，而不是更新缓存？

原因很简单，很多时候，复杂点的缓存的场景，缓存不单单是数据库中直接取出来的值。

比如可能更新了某个表的一个字段，然后其对应的缓存，是需要查询另外两个表的数据并进行运算，才能计算出缓存最新的值的。